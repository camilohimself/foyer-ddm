---
import Layout from '~/layouts/PageLayout.astro';
import Hero from '~/components/widgets/Hero.astro';
import Testimonials from '~/components/widgets/Testimonials.astro';
import CallToAction from '~/components/widgets/CallToAction.astro';
import { getCollection } from 'astro:content';

const metadata = {
  title: 'Témoignages de retraites spirituelles en Suisse',
  description: 'Témoignages de retraitants au Foyer de Charité Dents-du-Midi, Bex. Silence, paix, rencontre : découvrez ce que vivent ceux qui font une retraite spirituelle en Suisse.',
};

// Charger tous les témoignages depuis la collection
const allTestimonials = await getCollection('testimonial');
const testimonialsList = allTestimonials.map((t) => ({
  testimonial: t.data.quote,
  name: t.data.name,
  job: t.data.retreatType || 'Retraitant(e)',
}));
---

<Layout metadata={metadata}>
  <!-- Hero Section -->
  <Hero
    tagline="Expériences"
    title="Témoignages"
    subtitle="Paroles de ceux qui ont vécu une retraite au Foyer de Charité Dents-du-Midi."
  />

  <!-- Témoignages (dynamique — les 17 témoignages) -->
  <Testimonials
    title="Ils ont vécu <span class='text-accent-400'>l'expérience</span>"
    subtitle="Des retraitants partagent ce qu'ils ont vécu au Foyer : paix, silence, rencontre avec l'Essentiel."
    testimonials={testimonialsList}
  />

  <!-- Citation forte -->
  <section class="px-4 py-16 sm:px-6 mx-auto lg:px-8 lg:py-20 max-w-6xl bg-surface-special">
    <blockquote class="text-center">
      <p class="text-xl md:text-2xl font-medium text-primary-600 mb-6 italic">
        "J'ai découvert que le silence, c'est <span class="text-accent-400">Quelqu'un</span> !"
      </p>
      <cite class="text-muted">— François, retraitant</cite>
    </blockquote>
  </section>

  <!-- CTA -->
  <CallToAction
    isDark
    actions={[
      {
        variant: 'primary',
        text: 'Vivre l\'expérience',
        href: '/retraites',
      },
      {
        text: 'S\'inscrire',
        href: '/contact/inscription',
      },
    ]}
  >
    <Fragment slot="title">À votre tour de vivre cette expérience</Fragment>

    <Fragment slot="subtitle">
      Rejoignez ceux qui ont découvert la paix et le silence habité de l'Essentiel. Inscrivez-vous à une retraite.
    </Fragment>
  </CallToAction>
</Layout>
